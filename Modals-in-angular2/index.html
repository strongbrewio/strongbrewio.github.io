<!DOCTYPE html>
<html>
<head>
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page Meta -->
    <title>Modals in Angular 2</title>
    <meta name="description" content="Since one of my late New Year's resolutions is blogging, behold my very first blogpost. For a customer of mine I had to implement modal-dialog functionality in Angular. As most developers would do in this scenario, I crawled the web searching for existing solutions." />

    <!-- Mobile Meta -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Brand icon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />

    <!-- highlight.js -->
    <link href="/assets/css/prism.css" rel="stylesheet">

    <!-- Ghost outputs important style and meta data with this tag -->
        <link rel="canonical" href="/Modals-in-angular2/" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="Strongbrew" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Modals in Angular 2" />
    <meta property="og:description" content="Since one of my late New Year's resolutions is blogging, behold my very first blogpost. For a customer of mine I had to implement modal-dialog functionality in Angular. As most developers would do in this scenario, I crawled the web searching for existing solutions." />
    <meta property="og:url" content="//Modals-in-angular2/" />
    <meta property="og:image" content="/assets/images/cover/cover11.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Modals in Angular 2" />
    <meta name="twitter:description" content="Since one of my late New Year's resolutions is blogging, behold my very first blogpost. For a customer of mine I had to implement modal-dialog functionality in Angular. As most developers would do in this scenario, I crawled the web searching for existing solutions." />
    <meta name="twitter:url" content="//Modals-in-angular2/" />
    <meta name="twitter:image:src" content="/assets/images/cover/cover11.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Strongbrew",
    "name": "Modals in Angular 2",
    "url": "//Modals-in-angular2/",
    "image": "/assets/images/cover/cover11.jpg",
    "description": "Since one of my late New Year's resolutions is blogging, behold my very first blogpost. For a customer of mine I had to implement modal-dialog functionality in Angular. As most developers would do in this scenario, I crawled the web searching for existing solutions."
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Strongbrew" href="/feed.xml" />


</head>
<body class="home-template nav-closed">
    <div class="topbar">
        <div class="container">
            <a class="logo-wrapper" href="https://strongbrew.io">
                <img src="/assets/images/logo_website.png" alt="">
            </a>
            <div class="menu-wrapper">
                <ul class="menu">
                    <li><a href="https://strongbrew.io/about">Home</a></li>
                    <li><a href="https://strongbrew.io/brews" rel="noopener" routerLinkActive="active">Brews</a></li>
                    <li><a href="/" class="active">Blog</a></li>
                    <li><a href="https://strongbrew.io/consultancy" rel="noopener" routerLinkActive="active">Consultancy</a></li>
                    <li><a href="https://strongbrew.io/contact" rel="noopener" routerLinkActive="active">Contact</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- The blog navigation links -->
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a
                href="/">Home</a></li>
        <li class="nav-about " role="presentation"><a
                href="/about">About</a></li>
        
            <li class="nav-fables " role="presentation"><a href="/tag/AngularJS">AngularJS</a>
        
            <li class="nav-fables " role="presentation"><a href="/tag/Angular">Angular</a>
        
            <li class="nav-fables " role="presentation"><a href="/tag/Redux">Redux</a>
        
            <li class="nav-fables " role="presentation"><a href="/tag/RxJS">RxJS</a>
        
            <li class="nav-fables " role="presentation"><a href="/tag/Typescript">Typescript</a>
        
            <li class="nav-fables " role="presentation"><a href="/tag/Nx">Nx</a>
        
            <li class="nav-fables " role="presentation"><a href="/tag/@ngrx">@ngrx</a>
        
        <li class="nav-author " role="presentation"><a
                href="/author/brechtbilliet">Brecht</a></li>
        <li class="nav-author " role="presentation"><a
                href="/author/kwintenp">Kwinten</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->
<!-- The comment above "< default" means - insert everything in this file into -->
<!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header id="header" class="main-header post-head "
        style="background-image: url(/assets/images/cover/cover11.jpg) ">
    <nav class="main-nav  overlay  clearfix">
        
    </nav>
</header>

<div class="followme followme-abs" id="followme">
<h5>Want to work with us?</h5>
<a href="https://strongbrew.io/about" class="button" rel="noopener">Learn more</a>
</div>


<script type="text/javascript">
    var followMe = document.getElementById('followme');
    var header = document.getElementById('header');
    window.addEventListener('scroll', function() {
        if(window.scrollY > header.offsetHeight + 113) {
            followMe.classList.remove('followme-abs');
            followMe.classList.add('followme-fixed');
        } else {
            followMe.classList.remove('followme-fixed');
            followMe.classList.add('followme-abs');
        }
    });
</script>


<main class="content" role="main">

    <article class="post">
        <div class="post-inner">
            <header class="post-header">
                <h1 class="post-title">Modals in Angular 2</h1>
                <section class="post-meta">
                    <!-- <a href='/'></a> -->

                    
                    
                    <a href='/author/brechtbilliet'>Brecht Billiet</a>
                    
                    
                    
                    
                    <time class="post-date" datetime="2016-08-24">24 Aug 2016
                    </time>
                    <!-- [[tags prefix=" on "]] -->
                    
                    on
                    
                    
                    <a href='/tag/Angular'>Angular</a>
                    
                    
                    
                </section>
            </header>

            <section class="post-content">

                <p><strong>Updated at 3 september 2016 (RC.6 compliant)</strong></p>

<p>Since one of my late New Year’s resolutions is blogging, behold my very first blogpost.
For a customer of mine I had to implement modal-dialog functionality in Angular 2.
As most developers would do in this scenario, I crawled the web searching for existing solutions.</p>

<p>Since Angular 2 has made some big breaking changes in its latest release candidates, most of these solutions were deprecated. The ones that weren’t deprecated weren’t stable enough and/or very bloated.</p>

<p>What I needed was actually very simple… I just needed a service that would open modals in Angular 2 and I only needed a few features:</p>
<ul>
<li>Multiple modals that could be placed above each other</li>
<li>Custom modals</li>
<li>The ability to destroy modals inside and outside the custom modal-component</li>
</ul>

<p><strong>Note:</strong> I’m using bootstrap as css framework so I don’t have to worry about the styling.</p>

<p>What I needed was a simple service where I could pass a component that would get rendered on the page, without memory leaks of course. Basically, I needed something like this:</p>

<pre><code class="language-typescript">
// this was possible in RC.5
this.modalService.create(MyCustomModalComponent, {foo: "bar"});


// this is what we need to do in RC.6
this.modalService.create(MyModule, MyCustomModalComponent, {foo: "bar"});

</code></pre>

<p>Since I didn’t found any viable solutions, I decided to write it myself.</p>

<p>Writing this piece of functionality myself, actually made me realise a few things:</p>
<ul>
<li>It wasn't difficult to write this functionality on my own</li>
<li>It was way more flexible than the solutions I found on the internet</li>
<li>It wasn't bloated at all</li>
<li>I wrote very few lines of code</li>
<li><strong>We use too much dependencies from the net</strong></li>
</ul>

<p>Don’t get me wrong, I don’t think we should reinvent the wheel everytime. I’m just saying that sometimes it’s better to write something your self, when it doesn’t cost you to much effort and saves you a lot of bloat.</p>

<p>The thing about a lot of open-source libraries is they want to make everybody happy, which mostly comes with a lot of bloat and features you don’t really need. And…, with a big codebase, comes a big issuelist…</p>

<p><strong>Enough about that, let’s see how I implemented my requirements with very little code…</strong></p>

<h2 id="a-brief-overview-of-the-flow">A brief overview of the flow</h2>
<p>First of all the modal-placeholder will register the Injector and ViewContainerRef (see later) to the UserModalService. At that time we can create modals using the UserModalService. These modals will be rendered into the modal-placeholder.</p>

<p><img src="https://github.com/brechtbilliet/brechtbilliet.github.io/raw/master/_posts/angular2modal.png" alt="Image of Angular 2 modal scheme" /></p>

<h2 id="the-modal-placeholder">The modal placeholder</h2>

<p>In Angular 2, you can not just compile stuff to the DOM, you need a placeholder.
That’s why I created a <strong>modal-placeholder</strong>, that I can use like this. This will be the placeholder where our modals will be rendered in.</p>

<pre><code class="language-typescript">@Component({
    selector: "application",
    template: `    
       ...
       &lt;modal-placeholder&gt;&lt;/modal-placeholder&gt;
       ...
`
})
export class ApplicationContainer {
	...
}
</code></pre>

<p><strong>Let’s look at the implementation</strong></p>

<p>The modal-placeholder has 3 goals:</p>
<ul>
<li>Create a placeholder (see the # symbol)</li>
<li>It should register that placeholder to a service where we can render modals into it (see ViewContainerRef)</li>
<li>It should register the injector to that service. Our modals will need DI as well...</li>
</ul>

<pre><code class="language-typescript">@Component({
    selector: "modal-placeholder",
    template: `&lt;div #modalplaceholder&gt;&lt;/div&gt;`
})
export class ModalPlaceholderComponent implements OnInit {
    @ViewChild("modalplaceholder", {read: ViewContainerRef}) 
    	viewContainerRef;

    constructor(
    	private modalService: ModalService, 
    	private injector: Injector) {
    }
    ngOnInit(): void {
        this.modalService.registerViewContainerRef(this.viewContainerRef);
        this.modalService.registerInjector(this.injector);
    }
}
</code></pre>
<p>As you can see above the ViewContainerRef holds a reference to the #modalplaceholder</p>

<h2 id="the-modal-service">The modal service</h2>
<p>This is the service that will dynamically generate custom components.</p>

<pre><code class="language-typescript">export class ModalService {
    // here we hold our placeholder
    private vcRef: ViewContainerRef; 
    // here we hold our injector
    private injector: Injector; 
    // we can use this to determine z-index of multiple modals
    public activeInstances: number = 0;
    
    constructor(private compiler: Compiler) {
    }

    registerViewContainerRef(vcRef: ViewContainerRef): void {
        this.vcRef = vcRef;
    }

    registerInjector(injector: Injector): void {
        this.injector = injector;
    }

	// update: as of rc6 we have to pass the module as well
    create&lt;T&gt;(module: any, component: any, parameters?: Object):
     	Observable&lt;ComponentRef&lt;T&gt;&gt; {
     	// we return a stream so we can  access the componentref
        let componentRef$ = new ReplaySubject(); 
        // compile the component based on its type and
        // create a component factory
        this.compiler.compileModuleAndAllComponentsAsync(module)
            .then(factory =&gt; {
            	// look for the componentfactory in the modulefactory
             	let componentFactory = factory.componentFactories
             		.filter(item =&gt; item.componentType === component)[0];
            	// the injector will be needed for DI in 
            	// the custom component
                const childInjector = ReflectiveInjector
                	.resolveAndCreate([], this.injector);
            	// create the actual component
                let componentRef = this.vcRef
                	.createComponent(componentFactory, 0, childInjector);
                // pass the @Input parameters to the instance
                Object.assign(componentRef.instance, parameters); 
                this.activeInstances ++;
                // add a destroy method to the modal instance
                componentRef.instance["destroy"] = () =&gt; {
                    this.activeInstances --;
                    // this will destroy the component
                    componentRef.destroy(); 
                };
                // the component is rendered into the ViewContainerRef
                // so we can update and complete the stream
                componentRef$.next(componentRef);
                componentRef$.complete();
            });
        return componentRef$;
    }
}
</code></pre>

<h2 id="the-custom-modal">The Custom modal</h2>

<p>As we saw above, every modal component will have a destroy method. That method is dynamically added (see logic above) to the instance of the modalcomponent. This will call the <strong>componentRef.destroy()</strong> behind the scenes which will safely destroy the component. I also found it convenient to have a closeModal function on the modal as well. Therefore every custom modal component we create should inherit this class:</p>

<pre><code class="language-typescript">export class ModalContainer {
    destroy: Function;
    closeModal(): void {
        this.destroy();
    }
}
</code></pre>

<p>This means, a custom modal could look like this: (ideally you could also create a generic modal component)</p>

<pre><code class="language-typescript">@Component({
	selector: "my-custom-modal",
	template: `
	&lt;div modal="" class="modal fade in"&gt;
		&lt;div class="modal-dialog"&gt;
			&lt;div class="modal-content"&gt;
				 &lt;button type="button" class="close" 
				 	(click)="closeModal()"&gt;×&lt;/button&gt;
				...
			&lt;/div&gt;
		&lt;/div&gt;
	&lt;/div&gt;
	&lt;div class="modal-backdrop fade in"&gt;&lt;/div&gt;
`
})
export class MyCustomModalComponent extends ModalContainer {
	@Input() foo;
	onSave(): Function;
	constructor(){
		super();
	}
	// the closeModal function will be available 
	// on the ModalContainer parent class
}
</code></pre>

<p>I love typescript decorators, and I didn’t want to inherit this ModalContainer everytime.
I wanted to create modal components like this:</p>

<pre><code class="language-typescript">@Component({
	selector: "my-custom-modal",
	template: `
	...
`
})
@Modal() // this decorator is all it takes
export class MyCustomComponent {
	@Input() foo;
	onSave(): Function;
}
</code></pre>

<p>This is basically the same thing as the inheritance example above, but much cleaner right?</p>

<p>Here’s the code for the custom decorator: (How easy is that?!)</p>

<pre><code class="language-typescript">export function Modal() {
    return function (target) {
        Object.assign(target.prototype,  ModalContainer.prototype);
    };
}
</code></pre>

<p>Ok, so what we have now is:</p>
<ul>
<li>modal-placeholder</li>
<li>modal-service</li>
<li>Modal container class with destroy delegation</li>
<li>modal-decorator to make the inheritance cleaner</li>
</ul>

<p>And… that’s it folks. That’s the only code I had to write (cleaned up a bit but still…)
It’s flexible, maintainable and easy to use… Let me show you…</p>

<h2 id="how-to-use-it">How to use it</h2>

<p>I want to create a modal of Type “MyCustomComponent”, pass it the property foo (@input) and pass a callback for the onSave function.</p>

<p><strong>Update: Since RC.6 we have to pass the module as well</strong></p>

<pre><code class="language-typescript">this.modalService.create&lt;MyCustomComponent&gt;(MyModule, MyCustomComponent, 
{ 
	foo: "bar", 
	onSave: () =&gt; alert('save me')
});
</code></pre>

<p>But wait? What if we want to destroy it outside of the component, you said you needed control over de lifetime of the component right?</p>

<p>That’s why the create function returns an observable that contains the componentRef, which has a destroy function.</p>

<pre><code class="language-typescript">this.modalService.create&lt;MyCustomComponent&gt;(MyModule, MyCustomComponent, 
	{ 
		foo: "bar", 
		onSave: () =&gt; alert('save me')
	})
	.subscribe((ref: ComponentRef&lt;MyCustomComponent&gt;) =&gt; {
		//destroy after 1 second
		setTimeout(() =&gt; ref.destroy(), 1000);
	});
</code></pre>

<h2 id="aot">AOT</h2>

<p><a href="http://blog.mgechev.com/2016/08/14/ahead-of-time-compilation-angular-offline-precompilation/">Ahead-time-compilation</a> in angular2 breaks this pattern (because the compiler will not be available in production in that scenario). For AOT to work you just need to use the generated factory and update the modalservice like below.</p>

<pre><code class="language-typescript">createFromFactory&lt;T&gt;(componentFactory: ComponentFactory&lt;T&gt;, 
	parameters?: Object): Observable&lt;ComponentRef&lt;T&gt;&gt; {
    let componentRef$ = new ReplaySubject();
    const childInjector = ReflectiveInjector.resolveAndCreate([], this.injector);
    let componentRef = this.vcRef.createComponent(componentFactory, 0, childInjector);
    // pass the @Input parameters to the instance
    Object.assign(componentRef.instance, parameters); 
    this.activeInstances++;
    componentRef.instance["destroy"] = () =&gt; {
        this.activeInstances--;
        componentRef.destroy();
    };
    componentRef$.next(componentRef);
    componentRef$.complete();
    return componentRef$.asObservable();
}

// you can call it like that
this.modalService.createFromFactory(myCustomModalNgFactory);
</code></pre>

<h2 id="conclusion">Conclusion</h2>

<p>With very little code I created a flexible way to create custom modal’s. Don’t <strong>always</strong> blindly rely on open source solutions. Think about the complexity and flexibility first.</p>

<p>Thanks for reading! I Hope you enjoyed it</p>

<h2 id="plunk">Plunk</h2>

<p><a href="https://plnkr.co/edit/0c2YuGt7n7Fti0uup6Gs?p=info">Checkout this plunk I’ve created</a></p>


            </section>

            <footer class="post-footer">

                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->

                
                
                
                <figure class="author-image">
                    <a class="img" href="/author/brechtbilliet"
                       style="background-image: url(/assets/images/brecht.jpg)"><span class="hidden">brechtbilliet's Picture</span></a>
                </figure>
                

                <section class="author">
                    <h4><a href="/author/brechtbilliet">Brecht Billiet</a></h4>

                    
                    <p> Software architect/trainer/coach/speaker/blogger</p>
                    
                    <div class="author-meta">
                        <span
                            class="author-location icon-location"> Belgium</span>
                        <span class="author-link icon-link"><a href="http://www.brecht.io/"> brecht.io</a></span>
                        <span class="author-link icon-twitter"><a
                            href="https://twitter.com/brechtbilliet"> https://twitter.com/brechtbilliet</a></span>
                    </div>
                </section>

                <!-- /author  -->

                <section class="share">
                    <h4>Share this post</h4>
                    <a class="icon-twitter"
                       href="http://twitter.com/share?text=Modals in Angular 2&amp;url=Modals-in-angular2"
                       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                        <span class="hidden">Twitter</span>
                    </a>
                    <a class="icon-facebook"
                       href="https://www.facebook.com/sharer/sharer.php?u=Modals-in-angular2"
                       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                        <span class="hidden">Facebook</span>
                    </a>
                    <a class="icon-google-plus"
                       href="https://plus.google.com/share?url=Modals-in-angular2"
                       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                        <span class="hidden">Google+</span>
                    </a>
                </section>
                
                
                
                

                <!-- Add Disqus Comments -->
                
                
                <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT
     *  THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR
     *  PLATFORM OR CMS.
     *
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT:
     *  https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        // Replace PAGE_URL with your page's canonical URL variable
        this.page.url = PAGE_URL;

        // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        this.page.identifier = PAGE_IDENTIFIER;
    };
    */

    (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document, s = d.createElement('script');

        // IMPORTANT: Replace EXAMPLE with your forum shortname!
        s.src = 'https://brechtbilliet.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>
    Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">
        comments powered by Disqus.
    </a>
</noscript>
                
                
                

            </footer>
        </div>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
    <a class="read-next-story "
       style="background-image: url(/assets/images/cover/cover4.jpg)"
       href="/components-demystified">
        <section class="post">
            <h2>Components demystified</h2>
            <p>## Table of Contents 1. [Foreword](#foreword) 1. [Base concept](#base-concept) 1. [The hierarchical component-tree](#the-hierarchical-component-tree) 1. [Smart...</p>
        </section>
    </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
    <a class="read-next-story prev "
       style="background-image: url(/assets/images/cover/cover4.jpg)"
       href="/how-to-write-clean-reducers-and-test-them">
        <section class="post">
            <h2>How to write clean reducers (and test them!)</h2>
            <p>Last week, someone asked me how I kept my reducers clean and how to properly...</p>
        </section>
    </a>
    
    <!-- [[! /prev_post ]] -->
</aside>
<!-- /post -->


        <!-- The tiny footer at the very bottom -->
        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">Strongbrew</a> &copy; 2018</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/myjekyll/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- highlight.js -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- jQuery needs to come before `` so that jQuery can be used in code injection -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <!-- Ghost outputs important scripts and data with this tag -->
    <!--  -->
    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-112030289-1', 'auto');
	    ga('send', 'pageview');

     </script>
    <!-- Fitvids makes video embeds responsive and awesome -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <!-- The main JavaScript file for Casper -->
    <script type="text/javascript" src="/assets/js/index.js"></script>
    <script type="text/javascript" src="/assets/js/prism.js"></script>
</body>
</html>
